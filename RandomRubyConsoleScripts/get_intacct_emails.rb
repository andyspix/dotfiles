handler = IntacctApiHandler.new
handler.establish_session

accounts = Account.where(account_number: %w(10000000-000001 14262328-554087 18960824-686177 20028236-559080 21340183-295254 23414097-364147 23623565-703881 26384385-937545 29439870-894712 30319786-137500 31743283-851342 34215886-729782 36338717-666217 36402743-628873 37058141-377412 38647762-191916 39262862-707780 40679474-239802 41448997-676974 41730896-410564 43588935-501861 47298810-748069 47462536-114634 49607093-521636 50551406-428272 53503147-945643 55684813-200965 56089713-971040 56370284-413860 57124435-522649 58129968-449039 58279899-414625 65683602-390386 71100908-117551 71696114-865520 71905685-857963 79280843-204868 79704250-746015 84515324-665303 85009426-395369 88203832-902329 89067724-793014 91106759-466154 91785134-824397 92370122-836048 93155501-804373 93305669-466228 93354099-467018))

mail_list2 = []
accounts.each do |a|
  billto = a.intacct_configuration.billto.gsub(',', '\,')
  next if billto.blank?

  xml = handler.get_object_by_key_xml(Time.now.to_i, 'CONTACT', billto)
  resp = handler.post_xml(xml)
  contact_emails = [resp.parsed.xpath('//EMAIL1'), resp.parsed.xpath('//EMAIL2')]
  mail_list2 << [billto, contact_emails.join(', ').tr(';', ',')]
end
