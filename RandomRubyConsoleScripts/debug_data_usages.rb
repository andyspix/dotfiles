# Differences:
Device.joins(:monthly_data_usages, :daily_data_usages).where.not(bytes_used: 0).where('monthly_data_usages.date_for': '01-08-2020').where('devices.bytes_used != monthly_data_usages.bytes_used').count

# Find where DDU (today) == MDU, the first

date = Date.today.beginning_of_month
problems =[]
Device.find_each do |d|
  daily = d.daily_data_usages.where('date_for >= ?', date).sum(:bytes_used)
  monthly = d.monthly_data_usages.last&.bytes_used
  problems << [d.id, daily, monthly] unless (monthly.to_i - daily.to_i).zero?
end

vzw_acts = CarrierAccount.vzw

vzw_acts.map do |act|
  (Date.today.days_ago(20)..Date.today).map do |date|
    act.devices.joins(:daily_data_usages).where('daily_data_usages.date_for': date, bytes_used: 0).count
  end.join(',')
end
# ZEROS:
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
80353,80394,80447,80476,80466,80536,80450,80538,83889,80604,80519,80636,80402,80729,80476,80528,80535,80499,82050,80899,0
32112,32112,32112,32112,32112,32112,32112,32112,32112,32112,30112,28112,28112,18112,20112,30112,26112,18000,22112,14112,0
106779,108784,109821,110296,109238,109087,109487,109901,111999,112904,111522,111414,111318,111386,111509,113071,113532,111879,112478,110622,0
58295,60397,61431,61811,59166,58951,59066,59412,60796,61927,59475,59180,59093,59157,59356,60932,62030,59860,60925,59644,0

vzw_acts.map do |act|
  (Date.today.days_ago(20)..Date.today).map do |date|
    act.devices.joins(:daily_data_usages).where('daily_data_usages.date_for': date).sum(:'daily_data_usages.bytes_used')
  end.join(',')
end
# SUMS:
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
145452207752,55099110036,71512441618,32947007341,57363646111,89921807240,114029770353,84396720636,42367953976,37312332467,102266765368,58038140932,79076536581,67969141616,70286478762,68044736545,44427203338,59527358263,68814813081,27816700303,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
300933083666,236834070520,207302157292,201001613409,269093284411,292374103207,284029607355,276031077718,213636108115,202213496065,240115897944,256629533124,278719773674,257701320096,241370584632,217676352541,186944651313,232515929053,199793566011,107657505444,0
3425907767575,3077901871014,2995864880287,2791252585825,3398199726793,3944498785814,3648855926093,4317243987961,4442128574584,2919225065899,3338231189245,3540314239479,3332741248063,3507574166053,3554472543675,3017335357108,2715693080944,3048801615131,3517930703086,1270584815083,0

#DDU Counts
vzw_acts.map do |act|
  d_ids = act.devices.pluck(:id);0
  (Date.today.days_ago(20)..Date.today).map do |date|
    DailyDataUsage.where(date_for: date, device_id: d_ids).count
  end.join(',')
end

"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
